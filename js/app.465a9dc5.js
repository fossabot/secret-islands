(function(t){function e(e){for(var n,i,o=e[0],u=e[1],c=e[2],d=0,p=[];d<o.length;d++)i=o[d],r[i]&&p.push(r[i][0]),r[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);l&&l(e);while(p.length)p.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,o=1;o<a.length;o++){var u=a[o];0!==r[u]&&(n=!1)}n&&(s.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},s=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/secret-islands/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=u;s.push([1,"chunk-vendors"]),a()})({0:function(t,e){},"034f":function(t,e,a){"use strict";var n=a("64a9"),r=a.n(n);r.a},1:function(t,e,a){t.exports=a("56d7")},10:function(t,e){},11:function(t,e){},2:function(t,e){},3:function(t,e){},3068:function(t,e,a){},4:function(t,e){},5:function(t,e){},5490:function(t,e,a){"use strict";var n=a("bdf3"),r=a.n(n);r.a},"56d7":function(t,e,a){"use strict";a.r(e);a("ac6a"),a("cadf"),a("551c"),a("f751"),a("097d");var n=a("a026"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],i={name:"app",components:{}},o=i,u=(a("034f"),a("2877")),c=Object(u["a"])(o,r,s,!1,null,null,null),l=c.exports,d=a("8c4f"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{attrs:{id:"map"}},[a("MapSVG",{key:t.map_key,attrs:{id:"map_svg"}})],1),a("div",{staticClass:"container",attrs:{id:"thread_container"}},[a("div",{staticClass:"card-body"},[a("h2",{staticClass:"card-title"},[t._v(t._s(t.$route.params.x)+" / "+t._s(t.$route.params.y))]),a("Messages",{key:t.map_key,attrs:{x:t.$route.params.x,y:t.$route.params.y}})],1)])])},m=[],h=(a("6c7b"),{functional:!0,render(t,e){const{_c:a,_v:n,data:r,children:s=[]}=e,{class:i,staticClass:o,style:u,staticStyle:c,attrs:l={},...d}=r;return a("svg",{class:[i,o],style:[u,c],attrs:Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"1462",height:"949"},l),...d},s)}}),f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("Composer",{attrs:{x:t.$route.params.x,y:t.$route.params.y}}),a("div",{staticClass:"text-center",staticStyle:{width:"100%"}},[t.loading?a("div",{staticClass:"spinner-border",attrs:{label:"Spinning"}}):t._e()]),t._l(t.messages,function(t){return a("Message",{key:t.key,attrs:{message:t}})})],2)},g=[],v=a("cebc"),y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"media mt-3 col-sm-12 message"},[a("img",{staticClass:"pr-3 rounded ",staticStyle:{"max-width":"60px"},attrs:{src:t.avatar}}),a("div",{staticClass:"media-body"},[a("h5",{staticClass:"mt-0"},[t._v("\n      "+t._s(t.author.authorName)+"\n\n      "),a("span",{staticClass:"text-muted"},[t._v("\n        "+t._s(t.message.value.content.type)+"\n        "),t.message.value.content.channel?a("span",{staticClass:"text-dark"},[t._v("#"+t._s(t.message.value.content.channel))]):t._e()])]),a("p",{domProps:{innerHTML:t._s(t.textmd)}}),a("div",{staticClass:"float-right text-muted small"},[t.message.value.timestamp?a("timeago",{attrs:{datetime:t.message.value.timestamp,"auto-update":60}}):t._e()],1)])])},b=[],x=(a("b54a"),a("7f7f"),a("3e1e")),_=a.n(x);_.a.paraMap=a("a7b3");var $=a("8654"),w=$.isBlob,S={displayName:function(t,e,a){var n=this,r={},s={limit:1,reverse:!0,query:[{$filter:{value:{author:e,content:{type:"about",about:e,name:{$is:"string"}}},timestamp:{$gt:0}}},{$map:{name:["value","content","name"]}}]};_()(t.query.read(s),_.a.collect(function(t,s){var i;t?n.cb(t):(i=s&&s.length?s[0].name:e,r.authorName=i,a(null,r))}))},avatar:function(t,e,a){var n={reverse:!0,query:[{$filter:{value:{author:e,content:{type:"about",about:e,image:{$truthy:!0}},timestamp:{$gt:0}}}},{$map:{image:["value","content","image"]}}]};_()(t.query.read(n),_.a.map(function(t){return"string"===typeof t.image?t.image:t.image.link}),_.a.filter(function(t){return w(t)}),_.a.take(1),_.a.collect(function(t,e){t?a(t):e&&e.length?a(null,e[0]):a(null,null)}))}},k=a("91d2"),M=a.n(k);_.a.paraMap=a("a7b3");var j=a("90ce"),C={name:"message",props:["message"],data:function(){return{avatar:"https://via.placeholder.com/90x90",author:"...",textmd:"..."}},methods:{name_loaded:function(t,e){if(this.$data.author=e,"https://via.placeholder.com/90x90"==this.$data.avatar){var a=new M.a(300,e.authorName).getImage();this.$data.avatar=a}},avatar_loaded:function(t,e){e&&(this.$data.avatar="http://localhost:8989/blobs/get/"+e)}},mounted:function(){var t=this;this.$data.textmd=j.block(this.message.value.content.text,{toUrl:function(t){return"http://localhost:8989/blobs/get/"+t}}),this.$ssb.then(function(e){S.displayName(e,t.message.value.author,t.name_loaded),S.avatar(e,t.message.value.author,t.avatar_loaded)}),this.$nextTick(function(){})}},O=C,N=(a("d0b6"),Object(u["a"])(O,y,b,!1,null,"84c4a45e",null)),P=N.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-group media mt-2 col-sm-6 message"},[a("img",{staticClass:"pr-3 rounded ",staticStyle:{"max-width":"60px"},attrs:{src:t.avatar}}),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"form-control",attrs:{placeholder:"New message at this location"},domProps:{value:t.message},on:{click:function(e){t.writing=!0},input:function(e){e.target.composing||(t.message=e.target.value)}}}),t.writing?a("button",{staticClass:"btn btn-outline-primary",attrs:{type:"button"},on:{click:t.post}},[t._v("Post")]):t._e()])},q=[],E=a("50ce").create,I={name:"composer",props:{x:String,y:String},data:function(){return{avatar:"https://via.placeholder.com/90x90",message:"",writing:!1}},mounted:function(){var t=this;this.$ssb.then(function(e){S.avatar(e,JSON.parse(localStorage.keys).id,t.avatar_loaded)})},methods:{avatar_loaded:function(t,e){e&&(this.$data.avatar="http://localhost:8989/blobs/get/"+e)},post:function(t){var e=this;if(this.$data.message){var a=parseInt(this.$props.x),n=parseInt(this.$props.y);this.$ssb.then(function(t){t.getLatest(JSON.parse(localStorage.keys).id,function(r,s){console.log(r),console.log(s);var i=s?{id:s.key,sequence:s.value.sequence,timestamp:s.value.timestamp,queue:[]}:{id:null,sequence:null,timestamp:null,queue:[]};t.add(E(i,JSON.parse(localStorage.keys),null,{type:"post",text:e.$data.message,x:a,y:n},Date.now()),function(t,e,a){console.log("added!",t,e,a)})})})}}}},T=I,J=Object(u["a"])(T,z,q,!1,null,"1ea42014",null),G=J.exports,L=a("3e1e"),H=(a("90de"),2),V={name:"Messages",components:{Message:P,Composer:G},data:function(){return{ssb:"",messages:[],identity:"...",loading:!0}},props:{msg:String,x:String,y:String},methods:{message_arrived:function(t){t.sync?this.$data.loading=!1:this.$data.messages.push(t)},name_loaded:function(t,e){this.$data.identity=e.authorName}},mounted:function(){var t=this;this.$ssb.then(function(e){t.$data.ssb=e,S.displayName(e,localStorage.keys.id,t.name_loaded);var a=parseInt(t.$props.x),n=parseInt(t.$props.y),r={limit:100,reverse:!0,live:!0,query:[{$filter:{value:{content:{type:"post",x:{$is:"number"},y:{$is:"number"}}}}}]};if(!isNaN(a)&&!isNaN(n)){var s=r.query[0].$filter.value.content;s.x=Object(v["a"])({},s.x,{$gte:a-H,$lte:a+H}),s.y=Object(v["a"])({},s.y,{$gte:n-H,$lte:n+H})}var i=e.query.read(r);L(i,L.drain(t.message_arrived))}),this.$nextTick(function(){})}},A=V,U=Object(u["a"])(A,f,g,!1,null,"59576068",null),B=U.exports,D=a("e018");function F(t,e,a){var n=t.width,r=t.height,s=e.x,i=e.y,o=a.xExtreme,u=void 0===o?null:o,c=a.yExtreme,l=void 0===c?null:c,d=K((n-s)/2,u,Math.cos),p=K((r-i)/2,l,Math.sin);return Math.min(d,p)}function K(t,e,a){if(!e)return t;var n=t-e.value,r=(e.x-90)/180*Math.PI;return Math.abs(n/a(r))}var W={size:function(t,e,a,n){var r=e.width,s=e.height,i=a.x,o=a.y,u=n.last,c=Math.min(r-i,s-o)/2-u;t.size([360,c]).separation(function(t,e){return(t.parent===e.parent?1:2)/(0!==t.depth?t.depth:1)})},optimizeSize:function(t,e,a,n){var r=F(e,a,n||{});t.size([360,r]).separation(function(t,e){return(t.parent===e.parent?1:2)/(0!==t.depth?t.depth:1)})},transformNode:function(t,e){var a=(t-90)/180*Math.PI,n=e;return[~~(n*Math.cos(a)),~~(n*Math.sin(a))]},transformSvg:function(t,e,a){var n=a.width,r=a.height;return t.attr("transform","translate("+n/2+","+r/2+")")},updateTransform:function(t,e,a){var n=a.width,r=a.height;return t.translate(n/2,r/2)},getLine:function(t){return t.radialLine().radius(function(t){return t.y}).angle(function(t){return t.x/180*Math.PI})},transformText:function(t,e){return{x:t.x<180===!e?6:-6,rotate:t.x<180?t.x-90:t.x+90,anchor:t.x<180===!e?"start":"end"}}},X=a("5698");window.uber_hack_context="";var Y={},Q={directives:Y,components:{MapSVG:h,Messages:B},data:function(){return{map_key:1,messages:[]}},methods:{getSize:function(){var t=this.$el.clientWidth,e=this.$el.clientHeight;return{width:t,height:e}},transformSvg:function(t,e){return e=e||this.getSize(),W.transformSvg(t,this.margin,e)},updateTransform:function(t,e){return e=e||this.getSize(),W.updateTransform(t,this.margin,e)},resize:function(){console.log("resize?");var t=this.getSize(),e=this.internaldata,a=e.g,n=(e.svg,e.tree);this.transformSvg(a,t),W.optimizeSize(n,t,this.margin,this.textContraint),this.redraw()},inital_draw:function(){console.log("inital_draw"),uber_hack_context=this;var t=this.getSize(),e=X.select("#map_svg"),a=20,n=l(a,t.width,t.height),r=d(a),s=X.geoPath(r),i=e.insert("g","#map_svg"),o=i.append("g");o.attr("class","hexagon").selectAll("path").data(n.objects.hexagons.geometries).enter().append("path").attr("d",function(t){return s(D["a"](n,t))}).attr("class",function(t){return t.fill?"fill":null}).on("mousedown",u),i.append("g").append("path").datum(D["b"](n,n.objects.hexagons)).attr("class","mesh").attr("d",s);i.append("g").append("path").attr("class","border").call(c);function u(t){uber_hack_context.$router.push({path:"/".concat(t.i,"/").concat(t.j)}),uber_hack_context.$data.map_key+=1}function c(t){t.attr("d",s(D["b"](n,n.objects.hexagons,function(t,e){return t.fill^e.fill})))}function l(t,e,a){for(var n=2*t*Math.sin(Math.PI/3),r=1.5*t,s=Math.ceil((a+t)/r)+1,i=Math.ceil(e/n)+1,o=[],u=[],c=-1;c<=s;++c)for(var l=-1;l<=i;++l){var d=2*c,p=2*(l+(1&c)/2);u.push([[p,d-1],[1,1]],[[p+1,d],[0,1]],[[p+1,d+1],[-1,1]])}c=0;for(var m=3;c<s;++c,m+=6)for(l=0;l<i;++l,m+=3)o.push({type:"Polygon",arcs:[[m,m+1,m+2,~(m+3*(i+2-(1&c))),~(m-2),~(m-3*(i+2+(1&c))+2)]],fill:uber_hack_context.$route.params.x==l&&uber_hack_context.$route.params.y==c,j:c,i:l});return{transform:{translate:[0,0],scale:[1,1]},objects:{hexagons:{type:"GeometryCollection",geometries:o}},arcs:u}}function d(t){var e=2*t*Math.sin(Math.PI/3),a=1.5*t;return{stream:function(t){return{point:function(n,r){t.point(n*e/2,(r-(2-(1&r))/3)*a/2)},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}}}},redraw:function(){console.log("redraw")},location_redraw:function(){console.log("location redraw")}},mounted:function(){this.inital_draw(),this.redraw()},updated:function(){this.inital_draw(),this.redraw()}},R=Q,Z=(a("5490"),Object(u["a"])(R,p,m,!1,null,null,null)),tt=Z.exports;n["a"].use(d["a"]);var et=new d["a"]({routes:[{path:"/",name:"Home",component:tt},{path:"/:x/:y",name:"Map",component:tt}]}),at=a("8682"),nt=a("fd37");n["a"].use(at["a"],{locales:{en:a("52cf")}}),n["a"].use(nt["a"],{keys:localStorage.keys,remote:"wss://ssb.guild.land/~shs:+COav7rGgSXqV36bsgYJK1EHtUuk9SvojPFGdIzJLlA="}),n["a"].config.productionTip=!1,new n["a"]({router:et,template:"<app/>",components:{app:l}}).$mount("#app")},6:function(t,e){},"64a9":function(t,e,a){},7:function(t,e){},8:function(t,e){},9:function(t,e){},bdf3:function(t,e,a){},d0b6:function(t,e,a){"use strict";var n=a("3068"),r=a.n(n);r.a}});
//# sourceMappingURL=app.465a9dc5.js.map